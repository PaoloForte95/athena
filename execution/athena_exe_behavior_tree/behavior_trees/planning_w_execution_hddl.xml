<!--
This Behavior Tree computes and executed a plan. If the plan failed, it has recovery actions to recompute a plan.
-->

<root main_tree_to_execute="MasterTree">

<BehaviorTree ID="MasterTree">
  <Sequence>
  <ComputePlan name="ComputePlanAction" planner="TFD" execution_plan="{execution_plan}" domain_file="{domain_file}" problem_file="{problem_file}" plan_length="{plan_length}"/>
  <ExecutePlanNode name="PlanExecutor" plan_length="{plan_length}">
  <RateController hz="3.0">
  <DispatchMethods name="MethodDispatcher"  execution_plan="{execution_plan}" concurrent_methods="{concurrent_methods}" completed_methods="{completed_methods}"/>
  </RateController>
   <SubTree ID="Executor" __shared_blackboard="true"/>
 <!-- <RecoveryNode number_of_retries="1" name="PlanningWRecovery">
    <ComputePlan name="ComputePlanAction" planner="TFD" execution_plan="{execution_plan}"  domain_file="{domain_file}" problem_file="{problem_file}" plan_length="{plan_length}"/>
 
  </RecoveryNode>
   -->
 </ExecutePlanNode>
  </Sequence> 
</BehaviorTree>


<BehaviorTree ID="Executor">
<Parallel success_threshold= "2">
        <SubTree ID="MovePile" __shared_blackboard="true"/>
        <SubTree ID="MovePile" __shared_blackboard="true"/>
</Parallel>
</BehaviorTree>


<BehaviorTree ID="MovePile">
        <SelectedRobotController name= "robot1" robot_id= "1">
        <MovePileMethodNode name= "Move Pile">
         <SendMove name="Drive 1" service_name="/navigate_to_pose"/>
         <SendLoad name="Load" service_name="/send_load"/>
         <SendTransport name="Drive 2" service_name="/navigate_to_pose"/>
         <SendDump name="Dump" service_name="/send_dump"/>
        <IsPileMoved name="Check" ticks='3'/>
        </MovePileMethodNode>
        </SelectedRobotController>
</BehaviorTree>

<!-- <BehaviorTree ID="GoTo">
        <Fallback>
          <Sequence name="Move Action 1">
            <SendMove name="Drive 1" service_name="/navigate_to_pose"/>
            <SendMove name="Drive 2" service_name="/navigate_to_pose"/>
          </Sequence>
          <SendMove name="Drive 3" service_name="/navigate_to_pose"/>

        </Fallback>
</BehaviorTree>

<BehaviorTree ID="Load">
        <Fallback>
        <SendMove name="Pick" service_name="/navigate_to_pose"/>
        <SendMove name="Push"  service_name="/navigate_to_pose"/>
        <SendMove name="Unstack"  service_name="/navigate_to_pose"/>
        </Fallback>
</BehaviorTree>

<BehaviorTree ID="Dump">
        <Fallback>
        <SendMove name="Drop" service_name="/navigate_to_pose"/>
        <SendMove name="Stack"  service_name="/navigate_to_pose"/>
        </Fallback>
</BehaviorTree>
-->


</root>
